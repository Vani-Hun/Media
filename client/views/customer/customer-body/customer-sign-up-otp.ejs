<div class="container2">
    <form id="otpForm" class="form-otp" onsubmit="event.preventDefault(); verifyOtp();">
        <div class="otp-title">OTP</div>
        <div class="otp-title">Verification Code</div>
        <p class="otp-message">We have sent a verification code to your mobile number</p>
        <p class="otp-message" id="otp-error"></p>

        <div class="otp-inputs">
            <input id="input1" type="text" maxlength="1" oninput="moveToNextInput(this, 'input2', 'input1')">
            <input id="input2" type="text" maxlength="1" oninput="moveToNextInput(this, 'input3', 'input1')">
            <input id="input3" type="text" maxlength="1" oninput="moveToNextInput(this, 'input4', 'input2')">
            <input id="input4" type="text" maxlength="1" oninput="moveToNextInput(this, 'input5', 'input3')">
            <input id="input5" type="text" maxlength="1" oninput="moveToNextInput(this, 'input6', 'input4')">
            <input id="input6" type="text" maxlength="1" oninput="moveToNextInput(this, null, 'input5')">
        </div>
        <div class="button-otp">
            <button id="cancelButton" class="otp-action" type="button"
                onclick="window.location.href='/customer/sign-up'">Cancel</button>
            <button id="verifyButton" class="otp-action" type="submit" disabled>Verify me</button>
        </div>
    </form>
</div>
<div class="loader">
    <li class="ball"></li>
    <li class="ball"></li>
    <li class="ball"></li>
</div>
<div id="customAlert" class="custom-alert">
    <span id="alertMessage"></span>
</div>
<!-- 
<script type="module">
    import { initializeApp } from 'https://www.gstatic.com/firebasejs/10.8.0/firebase-app.js'
    import { getAnalytics } from 'https://www.gstatic.com/firebasejs/10.8.0/firebase-analytics.js'
    import { getAuth, signInWithPhoneNumber, RecaptchaVerifier } from 'https://www.gstatic.com/firebasejs/10.8.0/firebase-auth.js'
    import { getFirestore } from 'https://www.gstatic.com/firebasejs/10.8.0/firebase-firestore.js'

    var firebaseConfig = {
        apiKey: "AIzaSyAbjYYbreGwSN-pY5UoNZp-KF4yJcgWNV8",
        authDomain: "fir-76c15.firebaseapp.com",
        projectId: "fir-76c15",
        storageBucket: "fir-76c15.appspot.com",
        messagingSenderId: "112323394158",
        appId: "1:112323394158:web:db2d6bf8492a523ced847f",
        measurementId: "G-Q7ZQR4556T"
    };
    const app = initializeApp(firebaseConfig);
    const auth = getAuth(app);
    const phoneNumber = "0399427359";
    auth.languageCode = 'it';
    window.recaptchaVerifier = new RecaptchaVerifier(auth, 'sign-in-button', {
        'size': 'invisible',
        'callback': (response) => {
            const appVerifier = window.recaptchaVerifier;
            console.log("response:", response)
            signInWithPhoneNumber(auth, phoneNumber, appVerifier)
                .then((confirmationResult) => {
                    window.confirmationResult = confirmationResult;
                    console.log("confirmationResult:", confirmationResult)
                }).catch((error) => {
                    console.log("error:", error)
                });
        }
    });

    // window.recaptchaVerifier = new RecaptchaVerifier(auth, 'recaptcha-container', {
    //     'size': 'normal',
    //     'callback': (response) => {
    //         console.log("response:", response)
    //         const appVerifier = window.recaptchaVerifier;
    //         console.log("appVerifier:", appVerifier)
    //         signInWithPhoneNumber(auth, phoneNumber, appVerifier)
    //             .then((confirmationResult) => {
    //                 window.confirmationResult = confirmationResult;
    //                 console.log("confirmationResult:", confirmationResult)
    //             }).catch((error) => {
    //                 console.log("error:", error)
    //             });
    //     },
    //     'expired-callback': () => {
    //         // Response expired. Ask user to solve reCAPTCHA again.
    //         // ...
    //     }
    // });

</script> -->

<script>


    let message = JSON.parse('<%- JSON.stringify(message) %>');
    const otpErrorElement = document.getElementById('otp-error');
    function setOtpErrorText(text) {
        otpErrorElement.textContent = text;
    }
    setOtpErrorText(message);

    function showLoader() {
        var loader = document.querySelector('.loader');
        loader.classList.add('visible');
    }
    function hideLoader() {
        var loader = document.querySelector('.loader');
        loader.classList.remove('visible');
    }
    function showCustomAlert(message) {
        const customAlert = document.getElementById('customAlert');
        const alertMessage = document.getElementById('alertMessage');

        // Hiển thị thông báo
        alertMessage.textContent = message;
        customAlert.style.display = 'block';

        // Đóng thông báo sau khoảng 2 giây (2000 milliseconds)
        setTimeout(() => {
            // Ẩn thông báo
            customAlert.style.display = 'none';
        }, 1500);
    }
    function moveToNextInput(currentInput, nextInputId, prevInputId) {
        const maxLength = parseInt(currentInput.getAttribute('maxlength'));
        const currentLength = currentInput.value.length;

        if (currentLength === maxLength) {
            if (nextInputId) {
                const nextInput = document.getElementById(nextInputId);
                if (nextInput) {
                    nextInput.focus();
                }
            }
        } else if (currentLength === 0 && prevInputId && currentInput.selectionStart === 0) {
            const prevInput = document.getElementById(prevInputId);
            if (prevInput) {
                prevInput.focus();
            }
        }

        checkInputsFilled();
    }
    function checkInputsFilled() {
        const inputs = Array.from({ length: 6 }, (_, index) => document.getElementById(`input${index + 1}`).value);
        const isAllFilled = inputs.every(value => value !== '' && !isNaN(value));
        const verifyButton = document.getElementById('verifyButton');

        if (isAllFilled) {
            verifyButton.removeAttribute('disabled');
        } else {
            verifyButton.setAttribute('disabled', 'disabled');
        }
    }

    function verifyOtp() {
        const otpValue = document.getElementById('input1').value +
            document.getElementById('input2').value +
            document.getElementById('input3').value +
            document.getElementById('input4').value +
            document.getElementById('input5').value +
            document.getElementById('input6').value;
        const data = { otp: otpValue };
        // showLoader()
        // fetch('/customer/verify-otp', {
        //     method: 'POST',
        //     headers: {
        //         'Content-Type': 'application/json'
        //     },
        //     body: JSON.stringify(data)

        // })
        //     .then(response => {
        //         if (response.ok) {
        //             if (response.redirected) { window.location.href = response.url; }
        //         }
        //     })
        //     .catch(error => {
        //         console.error('Error:', error);
        //     });
        let code = otpValue
        console.log("code:", code)
        console.log("window.confirmationResult:", window.confirmationResult)
        window.confirmationResult.confirm(code).then(function (result) {

            var user = result.user;
            console.log(user);
        }).catch(function (error) {
            console.error(error);
        });
        console.log('OTP Sent!');
    }

</script>